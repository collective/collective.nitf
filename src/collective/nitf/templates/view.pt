<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="collective.nitf">

<head>
  <metal:styleslot fill-slot="style_slot">
    <link rel="stylesheet" type="text/css"
        media="all"
        tal:attributes="href string:${context/@@plone_portal_state/portal_url}/++resource++collective.nitf/galleria-theme/galleria.nitf_theme.css" />
  </metal:styleslot>
</head>

<body>
    <metal:bodytext fill-slot="main">
    <article vocab="http://schema.org/" typeof="Article"
          prefix="rnews: http://iptc.org/std/rNews/2011-10-07#">

    <div id="viewlet-above-content-title" tal:content="structure provider:plone.abovecontenttitle"
        tal:condition="not:ajax_load" />
    <p class="section" tal:content="context/section" property="rnews:articleSection"/>
    <h1 class="documentFirstHeading" tal:content="context/title" property="rnews:name"/>
    <h2 class="nitfSubtitle" tal:content="context/subtitle" property="rnews:alternativeHeadline"/>
	  <div id="viewlet-below-content-title"
         tal:content="structure provider:plone.belowcontenttitle"
		     tal:condition="not:ajax_load" />

    <div class="documentDescription" tal:content="context/description" property="rnews:description"/>

            <div class="newsImageContainer"
                tal:define="image context/getImage"
                tal:condition="image">
                <a href="@@nitf_galleria"
                   id="parent-fieldname-image"
                   class="parent-nitf-image"
                   tal:attributes="href string:${context/absolute_url}/@@nitf_galleria">
                 <img tal:define="scales image/@@images;
                                  thumbnail python: scales.scale('image', scale='mini');"
                      tal:condition="thumbnail"
                      tal:attributes="src thumbnail/url;
                                      width thumbnail/width;
                                      height thumbnail/height;
                                      alt context/imageCaption|nothing;"
                      property="rnews:thumbnailUrl" />
                </a>
                <p class="discreet"
                    tal:condition="context/imageCaption"
                    tal:content="context/imageCaption">
                    Image Caption
                </p>
				        <span id="lupa"></span>
            </div>

            <div tal:content="structure context/text/output|nothing" property="rnews:articleBody" />
            <fieldset id="related-items" tal:condition="context/relatedItems|nothing">
                <legend i18n:translate="">Related items</legend>
                <tal:relateditems tal:content="structure view/w/relatedItems/render" />
            </fieldset>

            <fieldset id="folder-listing" tal:condition="not:context/is_empty">
                <legend i18n:translate="">Contents</legend>
                <tal:block define="listing_macro context/folder_listing/macros/listing;
                                   contentFilter python:{'portal_type': ['File', 'Link']}">
                    <metal:use_macro use-macro="listing_macro" />
                </tal:block>
            </fieldset>

            <div class="newsview">
	            <script type="text/javascript">
	                (function($) {
	                    "use strict";
	                    $(document).ready(function() {
                                var link = $(".parent-nitf-image");
                                if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
                                    link.attr('href', link.attr('href').replace('@@nitf_galleria' , '@@nitf_galleria?ajax_include_head=1&ajax_load=1'));
                                } else {
                                link.prepOverlay({
        		    			    subtype: 'ajax',
        					    filter: '#content > *',
        					    width: ($(document).width()*0.95) + 'px',
        					    config: {
                                                        top: 'center',
        					        onLoad : function (e) {
        				                  Galleria.loadTheme("++resource++collective.nitf/galleria-theme/galleria.nitf_theme.js");
        				                  Galleria.configure({debug: false});
        				                  Galleria.run(".pb-ajax #mediabox");
        				                }
        				        }
            				});
                                }
                        });
                    })(jQuery);
                </script>
            </div>

    </article>
    </metal:bodytext>

</body>

</html>
