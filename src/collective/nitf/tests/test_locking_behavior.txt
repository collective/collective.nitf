*** Settings ***

Library  Selenium2Library  timeout=5 seconds  implicit_wait=3 seconds
Resource  keywords.txt
Variables  plone/app/testing/interfaces.py

Suite Setup  Start Browser and Log In
Suite Teardown  Close Browser

*** Variables ***

${ALT_ZOPE_HOST}  127.0.0.1
${ALT_PLONE_URL}  http://${ALT_ZOPE_HOST}:${PORT}/plone
${LOCKED_MESSAGE}  This item was locked by admin 1 minute ago.

*** Test Cases ***

Test Locking Behavior
    Log In As Site Owner
    Goto Homepage

    Go To  ${PLONE_URL}/n1
    Click Link  link=Edit

    # open a new browser to simulate a 2-user interaction
    Open Browser  ${ALT_PLONE_URL}
    Log In As Site Administrator
    Go To  ${ALT_PLONE_URL}/n1
    Click Link  link=Edit
    Page Should Contain  Locked  ${LOCKED_MESSAGE}

    # FIXME: http://stackoverflow.com/q/27430323/644075
    # Switch Browser  1
    # Click Link  link=View
    # Page Should Not Contain  Locked  ${LOCKED_MESSAGE}

    # Switch Browser  2
    # Go To  ${PLONE_URL}/n1
    # Page Should Not Contain  Locked  ${LOCKED_MESSAGE}
    # Click Link  link=Edit

    # Switch Browser  1
    # Go To  ${PLONE_URL}/n1
    # Click Link  link=Edit
    # Page Should Contain  Locked  ${LOCKED_MESSAGE}

    # Switch Browser  2
    # Go To  ${PLONE_URL}/n1
    # Page Should Not Contain  Locked  ${LOCKED_MESSAGE}
